<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
	<script src="../scripts/mootools.js"></script>
	<style>
		.tarjeta{
      position: relative;
      padding: 1%;
      background-color: #888;
      width: 90%;
      height: 6%;
      margin: 2%;
      margin-left: 5%;
      border-radius: 15px;
    }
    .icono{
      position: absolute;
      margin-top: 1%;
      top: 0;
      right: 0;
      width: 3.5%;
    }
    .icono:hover{
      filter: invert(100%);
      cursor: pointer;
    }
    .icono2{
      margin-right: 4%;
    }
    .icono1{
      margin-right: 12%;
    }
    .titulo{
      font-size: 160%;
      font-weight: bold;
      font-family: Montserrat;
    }
    .fecha{
      font-size: 110%;
      font-family: Montserrat;
      margin-left: 5%;
    }
	</style>
	<title>Proyectos</title>
</head>
<body style="background-color: #eee;">

<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <a class="navbar-brand" href="panel.html" style="padding: 1%; font-size: 175%;">Panel de Administrador</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarText">
    <ul class="navbar-nav mr-auto">
      
    </ul>
    <span class="navbar-text" style="position: absolute; right: 0; margin-right: 8.5%;">
    	<div id="nombre"></div>
    	
    </span>
    <img src="../media/img/usuario.png" style="width: 4%; height: auto; filter: invert(100%); position: absolute; right: 0; margin-right: 3%;">
  </div>
</nav>

<div class="modal fade" id="myModal" style="margin-top: 10%;">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Eliminar</h4>
      </div>
      <!-- Modal body -->
      <div class="modal-body">  	
    		<form id="eliminar">
					<div id="modalNombrePublicacion">a</div><br>
					<button class="btn btn-secondary">Cancelar</button>
					<button class="btn btn-danger" onclick="confirmarEliminacion()">Eliminar</button>
				</form>
      </div>
    </div>
  	</div>
</div>

<div class="modal fade" id="modalEditar" style="margin-top: 10%;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Editar información</h4>
      </div>
      <div class="modal-body">
        <form id="editarinfo">
          <label>Nombre:</label><br>
          <input type="text" name="nombreimgedit" id="modalnombrepredit" style="width: 95%;"><br><br>
          <label>Tipo:</label><br>
          <select name="tipoProyecto" id="modaltipopredit">
            <option value="Servicio social">Servicio Social</option>
            <option value="Residencias">Residencias Profesionales</option>
            <option value="Innovacion">Innovación</option>
            <option value="Otro..." selected>Otro...</option>
          </select><br><br>
          <label>Periodo de realización:</label><br>
          <select name="periodoProyecto" id="modalperiodopredit">
          <script type="text/javascript">
              const mes = new Date().getMonth();
              const anio = new Date().getYear();
              for(var i=0; i<=(anio-103); i++){
                if(i>0 || mes>=7)
                  document.write('<option value="Agosto-Diciembre '+(1900+anio-i)+'">Agosto-Diciembre '+(1900+anio-i)+'</option>');
                document.write('<option value="Enero-Junio '+(1900+anio-i)+'">Enero-Junio '+(1900+anio-i)+'</option>');
              }
            </script>
          </select><br><br>
          <label>Descripcion:</label><br>
          <textarea rows="4" name="descimgedit" id="modaldescpredit" style="width: 95%;"></textarea><br><br>
          <button class="btn btn-secondary">Cancelar</button>
          <button class="btn btn-warning" onclick="editarImg()">Editar</button>
        </form>
      </div>
    </div>
    </div>
</div>

<div id="cuerpo">
	Cargando...
</div>

<script>
	$('nombre').set('text', '[Nombre]');
  var idSeleccionada;
  var publicaciones = new Array();

  var editNombre;
  var editDesc;
  var editTipo;
  var editPeriodo;

  function crear(titulo, fecha, id, tipo, desc){
    $('cuerpo').appendHTML('<div class="tarjeta"><div class="titulo">'+titulo+'</div><div class="fecha">'+fecha+'</div><img class="icono icono1" src="../media/img/editar.png" onclick="modalEditar(\''+id+'\', \''+titulo+'\',\''+tipo+'\',\''+fecha+'\',\''+desc+'\')"><img class="icono icono2" src="../media/img/borrar.png" onclick="modalEliminar(\''+titulo+'\', \''+id+'\')"></div>');
  }

  function modalEliminar(nombre, id){
      $('modalNombrePublicacion').set('text', '¿Deseas eliminar el proyecto "'+nombre+'"?');
      idSeleccionada = id;
      var myModal = new bootstrap.Modal(document.getElementById('myModal'), {});
      myModal.toggle();
    }

  function modalEditar(id, nombre, tipo, periodo, desc){
      $('modalnombrepredit').set('value', nombre);
      $('modaldescpredit').set('value', desc);
      $('modaltipopredit').set('value', tipo);
      $('modalperiodopredit').set('value', periodo);
      idSeleccionada = id;
      var myModal = new bootstrap.Modal(document.getElementById('modalEditar'), {});
      myModal.toggle();
  }

  function confirmarEliminacion(){
    async function postData(url = 'http://localhost:3000/proyectos/proyecto/'+idSeleccionada, data = {}) {
      const response = await fetch(url, {
        method: 'DELETE'
      });
    }
    postData();
    alert("eliminada");
  }

  const promesa = new Promise(function(completado, error){
      fetch("http://localhost:3000/proyectos/proyecto/", {
        method: "GET", 
        mode: "cors", 
        cache: "no-cache", 
        credentials: "same-origin", 
        headers: {
            "Content-Type": "application/json"
      }}).then((res) => {
        return res.json()
      }).then((data)=>{
        respuesta = data;
        completado("1");
        return data;
      }).catch((e) => console.error(e));
    }).then(
      function(value){
        if(value=="1"){
          for(var i=0; i<respuesta.length; i++){
            var registro = new Array();
            registro.push(respuesta[i]["id"]);
            registro.push(respuesta[i]["nombre"]);
            registro.push(respuesta[i]["descripcion"]);
            registro.push(respuesta[i]["periodo"]);
            registro.push(respuesta[i]["tipo"]);
            publicaciones.push(registro);
          }
          $('cuerpo').set('text', '');
          for(var i=0; i<publicaciones.length; i++){
            crear(publicaciones[i][1], publicaciones[i][3], publicaciones[i][0], publicaciones[i][4], publicaciones[i][2]);
          }
        }
      }
    );
</script>
</body>
</html>